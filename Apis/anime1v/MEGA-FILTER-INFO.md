# üìå Informaci√≥n sobre el filtro de Mega

## ¬øPor qu√© Mega est√° excluido por defecto?

Los enlaces de Mega incluyen una **clave de cifrado** en el hash de la URL:
```
https://mega.nz/file/zlZlTbTK#9a8ui9hzqxY-iQ_F0_3hletor2_WqoB5fHI_AU7Znpw
                          ‚Üë Esta parte (#...) es la clave de descifrado
```

### Problema
Algunos navegadores y aplicaciones pueden **eliminar el hash** al copiar/pegar o redirigir enlaces, causando que Mega muestre un popup pidiendo la clave de descifrado manualmente.

### Soluci√≥n implementada
**Mega est√° excluido por defecto** para evitar confusi√≥n, pero puedes incluirlo cuando lo necesites.

## C√≥mo usar

### Sin Mega (por defecto)
```bash
GET /api/v1/anime/episode?url=https://animeav1.com/media/leviathan/1
```

**Respuesta:** PDrain, HLS, UPNShare, MP4Upload, 1Fichier

### Con Mega
```bash
GET /api/v1/anime/episode?url=https://animeav1.com/media/leviathan/1&includeMega=true
```

**Respuesta:** PDrain, HLS, UPNShare, **Mega**, MP4Upload, 1Fichier

### Combinaciones

```bash
# Solo Mega y PDrain
GET /api/v1/anime/episode?url=...&includeMega=true&excludeServers=hls,upnshare,mp4upload,1fichier

# Todo menos MP4Upload (incluye Mega)
GET /api/v1/anime/episode?url=...&includeMega=true&excludeServers=mp4upload

# Solo servidores r√°pidos (sin Mega ni 1Fichier)
GET /api/v1/anime/episode?url=...&excludeServers=1fichier
```

## Recomendaciones

### ‚úÖ Usar Mega cuando:
- Descargas con herramientas CLI (wget, curl, aria2)
- Aplicaciones que preservan el hash (#)
- Acceso directo sin redirecciones

### ‚ùå Evitar Mega cuando:
- Enlaces para usuarios finales en navegadores
- Sistemas que hacen redirects
- Integraciones que copian/pegan URLs

## Servidores recomendados

| Servidor | Velocidad | Fiabilidad | Notas |
|----------|-----------|------------|-------|
| **PDrain** | ‚ö°‚ö°‚ö° | ‚úÖ Alta | R√°pido, sin limitaciones |
| **HLS** | ‚ö°‚ö°‚ö° | ‚úÖ Alta | Streaming directo |
| **Mega** | ‚ö°‚ö° | ‚ö†Ô∏è Media | Requiere clave en hash |
| **1Fichier** | ‚ö° | ‚úÖ Alta | Lento pero estable |
| **MP4Upload** | ‚ö°‚ö° | ‚ö†Ô∏è Media | Puede tener ads |

## Configuraci√≥n en c√≥digo

### JavaScript/Node.js
```javascript
// Sin Mega (por defecto)
const response = await fetch(`${API_URL}/episode?url=${episodeUrl}`, {
  headers: { 'X-API-Key': apiKey }
});

// Con Mega
const response = await fetch(`${API_URL}/episode?url=${episodeUrl}&includeMega=true`, {
  headers: { 'X-API-Key': apiKey }
});

// Personalizado
const params = new URLSearchParams({
  url: episodeUrl,
  includeMega: 'true',
  excludeServers: 'mp4upload,1fichier'
});

const response = await fetch(`${API_URL}/episode?${params}`, {
  headers: { 'X-API-Key': apiKey }
});
```

### Python
```python
import requests

# Sin Mega
response = requests.get(
    f"{API_URL}/episode",
    params={'url': episode_url},
    headers={'X-API-Key': api_key}
)

# Con Mega
response = requests.get(
    f"{API_URL}/episode",
    params={'url': episode_url, 'includeMega': 'true'},
    headers={'X-API-Key': api_key}
)

# Personalizado
response = requests.get(
    f"{API_URL}/episode",
    params={
        'url': episode_url,
        'includeMega': 'true',
        'excludeServers': 'mp4upload,1fichier'
    },
    headers={'X-API-Key': api_key}
)
```

### cURL
```bash
# Sin Mega
curl -H "X-API-Key: YOUR_KEY" \
  "http://localhost:3000/api/v1/anime/episode?url=https://animeav1.com/media/leviathan/1"

# Con Mega
curl -H "X-API-Key: YOUR_KEY" \
  "http://localhost:3000/api/v1/anime/episode?url=https://animeav1.com/media/leviathan/1&includeMega=true"
```

## Formato de respuesta

```json
{
  "success": true,
  "data": {
    "episode": 1,
    "title": "Episodio 1",
    "streamLinks": {
      "SUB": [
        {
          "server": "PDrain",
          "url": "https://pixeldrain.com/u/LN3zSTWL?embed"
        }
        // Mega NO incluido por defecto
      ],
      "DUB": [...]
    },
    "downloadLinks": {
      "SUB": [
        {
          "server": "PDrain",
          "url": "https://pixeldrain.com/u/LN3zSTWL",
          "quality": "1080p"
        }
        // Mega NO incluido por defecto
      ],
      "DUB": [...]
    }
  },
  "source": "json"
}
```

Con `&includeMega=true`, Mega aparecer√° en las listas.

## Troubleshooting

### Problema: "Mega pide clave de descifrado"
**Soluci√≥n:** Aseg√∫rate de copiar la URL completa con el hash (#). Si el problema persiste, usa `excludeServers=mega` o no uses `includeMega=true`.

### Problema: "No hay enlaces de descarga"
**Soluci√≥n:** Verifica que el episodio tenga enlaces disponibles. Algunos episodios reci√©n publicados pueden no tener todos los servidores activos.

### Problema: "Quiero solo un servidor espec√≠fico"
**Soluci√≥n:** Excluye todos los dem√°s:
```
?url=...&includeMega=true&excludeServers=pdrain,hls,upnshare,mp4upload,1fichier
```
Esto dejar√° solo Mega.

## Cambios en versiones

### v1.0 (Actual)
- ‚úÖ Mega excluido por defecto
- ‚úÖ Par√°metro `includeMega=true` para incluirlo
- ‚úÖ Par√°metro `excludeServers` para filtrar otros
- ‚úÖ Funciona en streaming y descarga, SUB y DUB

### Futuro
- Configuraci√≥n de servidores preferidos por usuario
- Cache de enlaces para mejorar velocidad
- Detecci√≥n autom√°tica de enlaces ca√≠dos
